# NestJS v11 Routing Experiment

NestJS v11ã«ãŠã‘ã‚‹route shadowingã®æŒ™å‹•ã‚’æ¤œè¨¼ã™ã‚‹å®Ÿé¨“ãƒªãƒã‚¸ãƒˆãƒªã§ã™ã€‚

## ğŸ¯ å®Ÿé¨“ç›®çš„

[express-v5-routing-experiment](https://github.com/RNm-dove/express-v5-routing-experiment)ã¨åŒæ§˜ã®æ¡ä»¶ã§ã€NestJS v11ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æŒ™å‹•ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚

- UsersControllerã¨UserContentsControllerã‚’ä½œæˆã—ã€moduleç™»éŒ²é †åºã«ã‚ˆã‚‹å½±éŸ¿ã‚’èª¿æŸ»
- Route shadowingï¼ˆãƒ«ãƒ¼ãƒˆã®ä¸Šæ›¸ãï¼‰ãŒç™ºç”Ÿã™ã‚‹ã‹ã‚’ç¢ºèª
- `/users/:id/contents` ãŒ `/users/:id` ã«å¸åã•ã‚Œãªã„ã‹ã‚’æ¤œè¨¼

## ğŸ“Š å®Ÿé¨“çµæœ

âœ… **NestJS v11ã§ã¯ã€ã‚ˆã‚Šå…·ä½“çš„ãªãƒ‘ã‚¹ãŒå„ªå…ˆçš„ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã¾ã™ï¼**

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹çµæœ

| ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ã‚¹ | ãƒãƒƒãƒã—ãŸãƒ«ãƒ¼ãƒˆ | èª¬æ˜ |
|------------|----------------|------|
| `/users` | `/users` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ |
| `/users/123` | `/users/:id` | ãƒ¦ãƒ¼ã‚¶ãƒ¼123ã®è©³ç´° |
| `/users/config` | `/users/:id` | âš ï¸ `/users/:id`ã«**å¸åã•ã‚Œã‚‹**ï¼ˆconfigãŒIDã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ï¼‰ |
| `/users/123/contents` | `/users/:id/contents` | âœ… `/users/:id`ã«**å¸åã•ã‚Œãªã„** |
| `/users/123/contents/456` | `/users/:id/contents/:contentId` | âœ… æ­£ã—ãæœ€ã‚‚å…·ä½“çš„ãªãƒ«ãƒ¼ãƒˆã«ãƒãƒƒãƒ |

### é‡è¦ãªç™ºè¦‹

ğŸ” **NestJS v11ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ç‰¹å¾´**

1. **ã‚ˆã‚Šå…·ä½“çš„ãªãƒ‘ã‚¹ï¼ˆã‚ˆã‚Šå¤šãã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼‰ãŒå„ªå…ˆã•ã‚Œã‚‹**
   - `/users/:id/contents` ã¯ `/users/:id` ã‚ˆã‚Šå„ªå…ˆã•ã‚Œã‚‹
   - ãƒ«ãƒ¼ãƒˆã®å®šç¾©é †åºã‚„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ç™»éŒ²é †åºã¯å½±éŸ¿ã—ãªã„

2. **åŒã˜ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°ã®å ´åˆã€å®šç¾©é †åºãŒå„ªå…ˆã•ã‚Œã‚‹**
   - `/users/config` ã¯ `/users/:id` ã®å¾Œã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€`/users/:id` ã«å¸åã•ã‚Œã‚‹
   - Express v5ã§ã‚‚åŒæ§˜ã®æŒ™å‹•

3. **ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ç™»éŒ²é †åºã®å½±éŸ¿**
   - ãƒ†ã‚¹ãƒˆã§ã¯ `UserContentsController` â†’ `UsersController` ã®é †ã§ç™»éŒ²
   - ãã‚Œã§ã‚‚ `/users/:id/contents` ã¯æ­£ã—ããƒãƒƒãƒ
   - NestJSã¯ãƒ«ãƒ¼ãƒˆã®æ§‹é€ ã§å„ªå…ˆåº¦ã‚’æ±ºå®šã—ã€ç™»éŒ²é †åºã¯å½±éŸ¿ã—ãªã„

## ğŸ”„ CI/CD

GitHub Actionsã«ã‚ˆã‚Šã€ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã«è‡ªå‹•ã§ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
è¤‡æ•°ã®Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆ18.x, 20.x, 22.xï¼‰ã§ãƒ†ã‚¹ãƒˆã•ã‚Œã¾ã™ã€‚

## ğŸš€ ä½¿ã„æ–¹

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

### ãƒ“ãƒ«ãƒ‰

```bash
npm run build
```

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
npm test
```

### ã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
npm start
```

ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãŸã‚‰ã€ä»¥ä¸‹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ï¼š

- http://localhost:3000/users
- http://localhost:3000/users/123
- http://localhost:3000/users/config
- http://localhost:3000/users/123/contents
- http://localhost:3000/users/123/contents/456

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
.
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.module.ts              # AppModule - ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ç™»éŒ²
â”‚   â”œâ”€â”€ users.controller.ts        # UsersController - åŸºæœ¬ãƒ«ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ user-contents.controller.ts # UserContentsController - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ«ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ main.ts                    # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚   â””â”€â”€ app.spec.ts                # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å®Ÿé¨“ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ package.json                    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â”œâ”€â”€ tsconfig.json                   # TypeScriptè¨­å®š
â””â”€â”€ jest.config.js                  # Jestè¨­å®š
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆå†…å®¹

1. **åŸºæœ¬ãƒ«ãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ**: `/users` ãŒæ­£ã—ããƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’è¿”ã™ã‹
2. **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ«ãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ**: `/users/123` ãŒæ­£ã—ããƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ã‚’è¿”ã™ã‹
3. **ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ**: `/users/contents` ãŒã©ã®ã‚ˆã†ã«è§£é‡ˆã•ã‚Œã‚‹ã‹
4. **ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ«ãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ**: `/users/config` ãŒå¸åã•ã‚Œã‚‹ã‹ã‚’ç¢ºèª
5. **ãƒã‚¹ãƒˆãƒ«ãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ**: `/users/123/contents` ãŒ `/users/:id` ã«å¸åã•ã‚Œãªã„ã‹
6. **æ·±ã„ãƒã‚¹ãƒˆãƒ«ãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ**: `/users/123/contents/456` ãŒæ­£ã—ããƒãƒƒãƒã™ã‚‹ã‹
7. **ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ç™»éŒ²é †åºãƒ†ã‚¹ãƒˆ**: ç™»éŒ²é †åºãŒå½±éŸ¿ã—ãªã„ã“ã¨ã‚’ç¢ºèª

## ğŸ”„ å®Ÿé¨“æ¡ä»¶

- NestJS v11ã‚’ä½¿ç”¨
- `@Controller()` ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã¯ç©ºã§ä½¿ç”¨ï¼ˆãƒ‘ã‚¹ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãªã—ï¼‰
- ã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆå®šç¾©ã¯ãƒ¡ã‚½ãƒƒãƒ‰ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã§è¨˜è¿°ï¼š
  - `@Get('/users')`
  - `@Get('/users/:id')`
  - `@Get('/users/config')`
  - `@Get('/users/:id/contents')`
  - `@Get('/users/:id/contents/:contentId')`
- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ç™»éŒ²é †åº:
  1. `UserContentsController` (å…ˆã«ç™»éŒ²)
  2. `UsersController` (å¾Œã«ç™»éŒ²)

## ğŸ“ çµè«–

### NestJS v11 vs Express v5 ã®æ¯”è¼ƒ

| ç‰¹å¾´ | NestJS v11 | Express v5 |
|-----|-----------|-----------|
| ã‚ˆã‚Šæ·±ã„ãƒ‘ã‚¹ã®å„ªå…ˆ | âœ… å„ªå…ˆã•ã‚Œã‚‹ | âœ… å„ªå…ˆã•ã‚Œã‚‹ |
| `/users/config` ã®æ‰±ã„ | `/users/:id` ã«å¸å | `/users/:id` ã«å¸å |
| ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼/ãƒ«ãƒ¼ãƒˆç™»éŒ²é †åº | å½±éŸ¿ãªã— | å½±éŸ¿ãªã— |
| Route shadowing | ç™ºç”Ÿã—ãªã„ | ç™ºç”Ÿã—ãªã„ |

**çµè«–**: NestJS v11ã§ã¯ã€Express v5ã¨åŒæ§˜ã«ã€**ãƒ«ãƒ¼ãƒˆã®æ§‹é€ ï¼ˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°ï¼‰ã«åŸºã¥ã„ã¦å„ªå…ˆåº¦ãŒæ±ºã¾ã‚Šã¾ã™**ã€‚ã‚ˆã‚Šå…·ä½“çš„ãªï¼ˆã‚ˆã‚Šå¤šãã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’æŒã¤ï¼‰ãƒ‘ã‚¹ãŒå„ªå…ˆã•ã‚Œã‚‹ãŸã‚ã€`/users/:id/contents` ã®ã‚ˆã†ãªãƒ«ãƒ¼ãƒˆã¯ `/users/:id` ã®å®šç¾©é †åºã‚„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ç™»éŒ²é †åºã«é–¢ã‚ã‚‰ãšæ­£ã—ãæ©Ÿèƒ½ã—ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€RESTful APIã®è¨­è¨ˆãŒæŸ”è»Ÿã«ãªã‚Šã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ«ãƒ¼ãƒˆã¨å…·ä½“çš„ãªãƒ‘ã‚¹ã‚’è‡ªç”±ã«çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ğŸ“¦ ä¾å­˜é–¢ä¿‚

- **NestJS v11**: æœ€æ–°ã®NestJSãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **@nestjs/platform-express**: Expressçµ±åˆ
- **Jest**: ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **Supertest**: HTTPã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **TypeScript**: å‹å®‰å…¨ãªJavaScript

## å‚è€ƒ

- [express-v5-routing-experiment](https://github.com/RNm-dove/express-v5-routing-experiment)
- [NestJS Documentation](https://docs.nestjs.com/)